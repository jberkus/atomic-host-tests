#!/bin/bash
set -xeuo pipefail

NEW_TESTS=$((git diff --name-only master | grep 'tests/.*/main.yml') || true)

for NEW_TEST in "${NEW_TESTS[@]}"; do
    if [ -z $NEW_TEST ]; then
        ansible-playbook -vi testnode, common/ans_ah_head-1_deploy.yml
        ansible-playbook -vi testnode, tests/improved-sanity-test/main.yml
    else
        ansible-playbook -vi testnode, $NEW_TEST
    fi
done
